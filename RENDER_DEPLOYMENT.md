# Deploying VisionTrack Backend to Render

This guide will help you deploy your Django VisionTrack application to Render.

## Prerequisites

- A GitHub account (to push your code)
- A Render account (sign up at https://render.com)
- Gmail account with App Password (for email functionality)

## Step 1: Prepare Your Repository

Make sure all the deployment files are in your repository:
- ‚úÖ `requirements.txt` - Updated with production dependencies
- ‚úÖ `build.sh` - Build script for Render
- ‚úÖ `render.yaml` - Render configuration file
- ‚úÖ Updated `visiontrack/settings.py` with production settings

## Step 2: Push to GitHub

```bash
git add .
git commit -m "Add Render deployment configuration"
git push origin master
```

## Step 3: Create a New Web Service on Render

### Option A: Using Blueprint (Automated - Recommended)

1. Go to https://render.com/dashboard
2. Click **"New +"** ‚Üí **"Blueprint"**
3. Connect your GitHub repository (`visiontrack-backend`)
4. Render will automatically detect `render.yaml` and create:
   - Web Service (Django app)
   - PostgreSQL Database
5. Click **"Apply"**

### Option B: Manual Setup

1. Go to https://render.com/dashboard
2. Click **"New +"** ‚Üí **"PostgreSQL"**
   - Name: `visiontrack-db`
   - Database: `visiontrack`
   - User: `visiontrack`
   - Region: Choose closest to you
   - Plan: **Free**
   - Click **"Create Database"**

3. Click **"New +"** ‚Üí **"Web Service"**
   - Connect your GitHub repository
   - Name: `visiontrack-backend`
   - Region: Same as database
   - Branch: `master`
   - Root Directory: Leave blank
   - Runtime: **Python 3**
   - Build Command: `./build.sh`
   - Start Command: `gunicorn visiontrack.wsgi:application`
   - Plan: **Free**

## Step 4: Configure Environment Variables

In your Render Web Service dashboard, go to **"Environment"** and add these variables:

### Required Variables:
```
SECRET_KEY=<auto-generated by Render or use your own>
DEBUG=False
ALLOWED_HOSTS=<your-app-name>.onrender.com
DATABASE_URL=<auto-linked from PostgreSQL database>
```

### Email Configuration:
```
EMAIL_BACKEND=django.core.mail.backends.smtp.EmailBackend
EMAIL_HOST=smtp.gmail.com
EMAIL_PORT=587
EMAIL_USE_TLS=True
EMAIL_HOST_USER=<your-email@gmail.com>
EMAIL_HOST_PASSWORD=<your-gmail-app-password>
```

**How to get Gmail App Password:**
1. Go to your Google Account ‚Üí Security
2. Enable 2-Step Verification
3. Go to "App passwords"
4. Generate a password for "Mail"
5. Use that 16-character password

### Site Configuration:
```
DOMAIN=<your-app-name>.onrender.com
SITE_NAME=VisionTrack
```

## Step 5: Deploy

1. After setting environment variables, click **"Manual Deploy"** ‚Üí **"Deploy latest commit"**
2. Watch the build logs for any errors
3. The deployment process will:
   - Install dependencies from `requirements.txt`
   - Collect static files
   - Run database migrations
   - Start the application with Gunicorn

## Step 6: Verify Deployment

1. Once deployed, click the URL (e.g., `https://visiontrack-backend.onrender.com`)
2. You should see your API
3. Test endpoints:
   - `https://your-app.onrender.com/api/auth/users/` - User registration
   - `https://your-app.onrender.com/api/auth/jwt/create/` - Login
   - `https://your-app.onrender.com/admin/` - Django admin

## Step 7: Create Superuser (Admin Account)

After deployment, you need to create an admin account:

1. In Render dashboard, go to your web service
2. Click **"Shell"** tab
3. Run:
```bash
python manage.py createsuperuser
```
4. Follow the prompts to create your admin account

## Important Notes

### Free Tier Limitations:
- **Web Service**: Spins down after 15 minutes of inactivity (first request takes ~30 seconds)
- **Database**: 90-day expiration, 1GB storage limit
- **Build Time**: Limited minutes per month

### Static Files:
- Served by WhiteNoise (configured in settings.py)
- No need for separate CDN on free tier

### Media Files:
- ‚ö†Ô∏è Free tier has **no persistent storage** for uploaded files
- Consider using:
  - **Cloudinary** (free tier: 25GB storage, 25GB bandwidth)
  - **AWS S3** with `django-storages`
  - **Render Disk** (paid plans only)

### Database Backups:
- Free PostgreSQL doesn't include automatic backups
- Export data regularly: `pg_dump` via Shell

### CORS Configuration:
- Update `CORS_ALLOWED_ORIGINS` in settings.py with your frontend URL
- Currently set to `CORS_ALLOW_ALL_ORIGINS = True` (not recommended for production)

## Troubleshooting

### Build Fails:
- Check `build.sh` has execution permissions
- Verify all packages in `requirements.txt` are compatible
- Check build logs for specific errors

### Database Connection Errors:
- Verify `DATABASE_URL` is properly linked
- Check database is in the same region
- Ensure `psycopg2-binary` is in requirements.txt

### Static Files Not Loading:
- Run `python manage.py collectstatic` manually in Shell
- Verify `STATIC_ROOT` and `STATICFILES_STORAGE` settings
- Check WhiteNoise is in MIDDLEWARE

### Application Crashes:
- Check logs in Render dashboard
- Verify all environment variables are set
- Look for missing dependencies

## Updating Your Application

1. Make changes locally
2. Test thoroughly
3. Commit and push to GitHub:
   ```bash
   git add .
   git commit -m "Your update message"
   git push origin master
   ```
4. Render will automatically rebuild and redeploy

## Monitoring

- **Logs**: Render Dashboard ‚Üí Your Service ‚Üí Logs
- **Metrics**: Render Dashboard ‚Üí Your Service ‚Üí Metrics
- **Events**: Track deployments and errors

## Cost Optimization

Free tier is sufficient for:
- Development/testing
- Small projects
- Portfolio demonstrations

Upgrade when you need:
- No spin-down delays
- Persistent disk storage for media files
- Database backups
- More compute resources

## Security Recommendations

1. ‚úÖ Set `DEBUG=False` in production
2. ‚úÖ Use strong `SECRET_KEY`
3. ‚úÖ Limit `ALLOWED_HOSTS` to your domain
4. ‚ö†Ô∏è Change `CORS_ALLOW_ALL_ORIGINS` to specific origins
5. ‚úÖ Keep dependencies updated
6. ‚úÖ Use environment variables for sensitive data
7. ‚ö†Ô∏è Enable HTTPS (automatic on Render)

## Next Steps

1. Configure your frontend to use the Render backend URL
2. Set up custom domain (optional, available on all plans)
3. Configure email templates in Djoser
4. Set up monitoring/logging (e.g., Sentry)
5. Implement media storage solution (Cloudinary/S3)

## Support

- Render Docs: https://render.com/docs
- Django Deployment: https://docs.djangoproject.com/en/stable/howto/deployment/
- Community: Render Community Forum

---

**Your app will be available at:**
`https://<your-service-name>.onrender.com`

üéâ Happy deploying!
